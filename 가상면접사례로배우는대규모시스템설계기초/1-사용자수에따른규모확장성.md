## 첫장
기업들은 시스템 설계 면접을 광범위하게 시행하고 있는데, 의사소통 및 문제 해결 능력이 소프트웨어 엔지니어가 업무상 필요로하는 능력과 비슷해서다.

'모호한 문제'를 어떻게 분석하고 단계적으로 해결하는지를 살펴보게 된다.
문제 해결 아이디어를 어떻게 설명하고 토론하는지, 그리고 그 아이디어를 어떻게 평가하고 개선하는지도 중요하게 따진다.

시스템 설계시 파악해야하는 중요 포인트들
- 시스템 요구사항
- 제약사항
- 성능 병목지점

## 1. 사용자 수에 따른 규모 확장성

## - 단일서버

모든 컴포넌트가 하나의 서버에서 실행될때

_한대에 웹, 앱, 데이터베이스, 캐시 등이 전부 한대에서 실행_

![image](https://github.com/yujindonut/Study/assets/78431728/427490c6-1173-4dda-b10c-7537f3414214)

1. 사용자는 도메인 이름을 이용하여 웹사이트에 접속. 접속을 위해서는 도메인 이름을 DNS(도메인 이름 서비스)에 질의하여 IP 주소로 변환하는 과정이 필요하다.
2. DNS 조회 결과로 IP주소가 반환. (그림 1-2의 웹서버의 주소)
3. 해당 IP 주소로 HTTP요청이 전달된다.
4. 요청을 받은 웹서버는 HTML 페이지나 JSON 형태의 응답을 반환한다.
요청은 두가지 단말로 부터 온다. 웹 앱, 모바일 앱
   - 웹 애플리케이션 : 서버 구현용 언어로, 비즈니스 로직, 데이터 저장 등을 처리
   - 모바일 앱 : 모바일 앱과 웹 서버간 통신을 위해 **HTTP 프로토콜** 이용 HTTP 프로토콜을 통해서 반환될 응답 데이터의 포맷으로는 보통 JSON이 사용됨.

## - 데이터베이스

![image](https://github.com/yujindonut/Study/assets/78431728/93650892-c7ad-413e-ac7b-55f7721b8418)

사용자가 늘면 서버 하나는 웹/모바일 트래픽 처리 용도, 다른 하나는 데이터베이스 용을 둔다.
웹 계층 서버와 데이터베이스 서버를 분리하면 그 각각을 독립적으로 확장해 나갈 수 있게 된다.

- RDBMS : 관계형 데이터베이스
  - 조인 연산
- NO SQL : 
  - 비관계형 데이터베이스. 키-값 저장소, 그래프 저장소, 칼럼 저장소, 문서 저장소.
  - 조인 연산 하지 않는다.

##### 비관계형 데이터베이스가 바람직한 선택일 경우

- 아주 낮은 응답 지연 시간이 요구될 때
- 다루는 데이터가 비정형 (관계형 데이터가 아닐때)
- 데이터(JSON, YAML, XML 등)을 직렬화하거나 역직렬화 할 수 있기만 하면 될때
- 아주 많은 양의 데이터를 저장할 필요가 있을때


### - 수직적 규모 확장 VS 수평적 규모 확장
- Scale up (수직적 규모 확장)
  - 서버에 고사양 자원(더 좋은 CPU, 더 많은 RAM 등)을 추가하는 행위
  - 장점
    - 트래픽의 양이 적을때 비용적으로 효울적
  - 단점
    - 수직적 규모 확장에는 한계가 있다. 한대의 서버에 CPU나 메모리를 무한대로 증설이 불가능
    - 장애에 대한 자동복구(fail over) 방안이나 다중화(re-dundancy) 방안을 제시하지 않는다. 서버에 장애가 발생하면 웹사이트/앱은 완전히 중단
- Scale out (수평적 규모 확장)
  - 더 많은 서버를 추가하여 성능을 개선

### 로드밸런서
- 웹서버에 너무 많은 사용자가 접속하여 한계 상황에 도달하게 되면 응답 속도가 느려지거나 서버 접속이 불가능해진다.
- 부하 분산 집합(load balancing set)에 속한 웹 서버들에게 트래픽 부하를 고르게 분산하는 역할을 한다.
![img.png](img.png)
- 사용자는 로드밸런서의 공개 IP주소로 접속한다. > 웹 서버는 클라이언트의 접속을 직접 처리 X
- 보안을 위해, 서버 간 통신에는 **사설 IP주소**가 이용됨.
  - 같은 네트워크에 속한 서버 사이의 통신에만 쓰일 수 있는 IP 주소, 인터넷을 통해서는 접속할 수 없다.
  - 로드밸런서는 웹 서버와 통신하기 위해 바로 이 사설 주소를 이용.
- 장점
  - 장애 자동복구하지 못하는 문제(No failover) 해소
    - 서버1이 다운될 때(offline 상태), 모든 트래픽 서버2로 전송.
    - 웹사이트 전체가 다운되는 일이 방지됨
    - 부하를 나누기 위해 새로운 서버를 추가
  - 웹 계층의 가용성(availability) 향상
    - 웹사이트로 유입되는 트래픽이 가파르게 증가하면 두대의 서버로 트래픽을 감당할 수 없는 시점이 오게 되는데, 서버 추가만 하면 로드 밸런스가 자동적으로 트래픽을 분산시켜줌

### 데이터베이스 다중화 
- 서버 사이에 주(Master)-부(slave) 관계를 설정하고 데이터 원본은 주 서버에, 사본은 부 서버에 저장하는 방식.
- 부 데이터베이스는 주 데이터베이스로부터 그 사본을 전달받으며, 읽기 연산만을 지원한다. 
- 데이터베이스를 변경하는 명령어들, 가령 insert, delete, update 등은 주 데이터베이스로만 전달되어야한다.
- 읽기 연산 > 쓰기 연산 (주 데이터베이스 수 < 부 데이터베이스 수)
- 장점
  - 더 나은 성능 
    - 읽기 연산이 부 데이터베이스 서버들로 분산
    - 병렬 처리 될 수 있는 query의 수가 증가됨
  - 안정성
    - 자연 재해 등의 이유로 데이터베이스 서버 가운데 일부가 파괴되어도 데이터는 보존됨.
    - 데이터를 지역적으로 떨어진 여러 장소에 다중화 시켜놓을 수 있다.
  - 가용성
    - 데이터를 여러 지역에 복제함으로써, 하나의 데이터베이스 서버에 장애가 발생하더라도 다른 서버에 있는 데이터를 가져와 계속 서비스할 수 있음.
- 상황 
  - 주 데이터베이스 서버 다운
    - 한대의 부 데이터베이스만 있는 경우 해당 부 데이터베이스 서버가 새로운 주 서버가 됨.
    - 부 서버에 보관된 데이터가 최신 상태가 아닐 수 있기 때문에, 없는 데이터는 복구 스크립트를 돌려서 추가해야한다.
    - 다중 마스터나 원형 다중화 방식을 도입
